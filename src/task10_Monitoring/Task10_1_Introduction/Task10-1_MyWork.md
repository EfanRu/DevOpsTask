# Домашнее задание к занятию 13 «Введение в мониторинг»


### Задание 1
    Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя 
    платформу для вычислений с выдачей текстовых отчётов, которые сохраняются на диск. 
    Взаимодействие с платформой осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. 
    Какой минимальный набор метрик вы выведите в мониторинг и почему?

### Решение 1
    CPU LA - так как вычисления загружают CPU, а и это один из основных показателей работы;
    RAM/Swap - так как приложение может утекать по памяти и нужно вовремя это отследить.
    FS - для проверки, что диски не заполнились.
    Анализ статусов http запросов для анализа количества 500 статусов и количества активных пользователей.
    Если пользователей с среднем бывает 100, а вдруг стало 0, то может быть они не могут подключиться? Аналогично, 
    с 500 ошибкой, не хотелось бы что-бы она появлялась чаще некого определенного числа (зависит от приложения).

### Задание 2
    Менеджер продукта, посмотрев на ваши метрики, сказал, что ему непонятно, что такое RAM/inodes/CPUla. 
    Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество 
    обслуживания. Что вы можете ему предложить?

### Решение 2
    Если менеджер не понимает эти метрики, то тратить время на объяснение не стоит. Нужно перейти на следующий 
    уровень абстракции, то есть к SLI (Service level indicators) — набор ключевых метрик, по которым можно определить 
    жизненный статус сервиса, его производительность, «удовлетворенность» конечных пользователей работой сервиса. 
    Например, в SLI может входить количество 500-х ошибок или количество активных пользователей.

### Задание 3
    Вашей DevOps-команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики, 
    в свою очередь, хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в 
    этой ситуации, чтобы разработчики получали ошибки приложения?

### Решение 3
    Просто и сердито - предоставить разработчикам файлы логов сервера, где будут они смогут искать сообщения об ошибках.
    Долго сложно и забирает время у разрабочиков? Ну так увеличьте финансирование на мониторинг!

### Задание 4
    Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA = 99% по http-кодам ответов. 
    Этот параметр вычисляется по формуле: summ_2xx_requests/summ_all_requests. Он не поднимается выше 70%, но при 
    этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?

### Решение 4
    Забыли учесть, что есть 100 информационные статусы и 300 статусы перенаправления.
    То есть нужно поменять формулу на summ_not_in_4xx_and_5xx_requests/summ_all_requests.

### Задание 5
    Опишите основные плюсы и минусы pull и push систем мониторинга.

### Решение 5
    Pull система мониторинга хороша тем, что просто настраивается, но из минусов мы не можем удаленно повлиять 
    на получаемые данные (изменить их характер, формат и т.п.). Ещё Pull система мониторинга плохо работает с 
    промежуточным программным обеспечением, а затраты на облуживание очень высоки.

    Push система мониторинга хороша наоборот тем, что управление и конфигурация осуществляются централизованно, но нам 
    требуется установить агентов, которые будут отправлять нам данные. А в случае потери канала связи, нужно будет 
    проверять работу агента.

    Подробнее:
    https://www.alibabacloud.com/blog/pull-or-push-how-to-select-monitoring-systems_599007
    

### Задание 6
    Какие из ниже перечисленных систем относятся к push модели, а какие к pull? А может есть гибридные?
        Prometheus
        TICK
        Zabbix
        VictoriaMetrics
        Nagios

### Решение 6
    Push & pull:
        Prometheus
        Zabbix
        VictoriaMetrics
    Push only:
        TICK
    Pull only:
        Nagios


### Задание 7
    Склонируйте себе репозиторий и запустите TICK-стэк, используя технологии docker и docker-compose.
    В виде решения на это упражнение приведите скриншот веб-интерфейса ПО chronograf (http://localhost:8888).
    P.S.: если при запуске некоторые контейнеры будут падать с ошибкой - проставьте им режим Z, например ./data:/var/lib:Z

### Решение 7
![Run_chronograph.png](Screenshots%2FRun_chronograph.png)


### Задание 8
    Перейдите в веб-интерфейс Chronograf (http://localhost:8888) и откройте вкладку Data explorer.
        Нажмите на кнопку Add a query
        Изучите вывод интерфейса и выберите БД telegraf.autogen
        В measurments выберите mem->host->telegraf_container_id , а в fields выберите used_percent. Внизу появится график утилизации оперативной памяти в контейнере telegraf.
        Вверху вы можете увидеть запрос, аналогичный SQL-синтаксису. Поэкспериментируйте с запросом, попробуйте изменить группировку и интервал наблюдений.

    Для выполнения задания приведите скриншот с отображением метрик утилизации места на диске (disk->host->telegraf_container_id) из веб-интерфейса.

### Решение 8
    SELECT mean("sys") AS "mean_sys" FROM "telegraf"."autogen"."influxdb_memstats" WHERE time > :dashboardTime: AND time < :upperDashboardTime: AND "host"='telegraf-getting-started' GROUP BY time(:interval:) FILL(null)

![Mem_status.png](Screenshots%2FMem_status.png)


### Задание 9
    Изучите список telegraf inputs. Добавьте в конфигурацию telegraf следующий плагин - docker:

    [[inputs.docker]]
      endpoint = "unix:///var/run/docker.sock"
    
    Дополнительно вам может потребоваться донастройка контейнера telegraf в docker-compose.yml дополнительного volume и режима privileged:
    
      telegraf:
        image: telegraf:1.4.0
        privileged: true
        volumes:
          - ./etc/telegraf.conf:/etc/telegraf/telegraf.conf:Z
          - /var/run/docker.sock:/var/run/docker.sock:Z
        links:
          - influxdb
`        ports:
          - "8092:8092/udp"
          - "8094:8094"
          - "8125:8125/udp"`
    
    После настройке перезапустите telegraf, обновите веб интерфейс и приведите скриншотом список measurments в веб-интерфейсе базы telegraf.autogen . Там должны появиться метрики, связанные с docker.
    
    Факультативно можете изучить какие метрики собирает telegraf после выполнения данного задания.

### Решение 9
    В файле ./telegraf/telegraf.conf уже присутствует строка endpoint = "unix:///var/run/docker.sock".
    Репозиторий скачивал по ссылке в задании.
    Сделал все поинструкции. Магия не произошла, метрики docker не появились(( Или это и есть искомые метрики? 
![Docker_metrics.png](Screenshots%2FDocker_metrics.png)


### Дополнительное Задание
      К сожелению вынужден оставить на после курсов((

      Выполнение этого задания необязательно и никак не влияет на получение зачёта по домашней работе.
   
      _____
      
      Вы устроились на работу в стартап. На данный момент у вас нет возможности развернуть полноценную систему 
      мониторинга, и вы решили самостоятельно написать простой python3-скрипт для сбора основных метрик сервера. 
      
      Вы, как опытный системный администратор, знаете, что системная информация сервера лежит в директории `/proc`. Также знаете, что в системе Linux есть  планировщик задач cron, который может запускать задачи по расписанию.
      
      Суммировав всё, вы спроектировали приложение, которое:
      
      - является python3-скриптом;
        - собирает метрики из папки `/proc`;
        - складывает метрики в файл 'YY-MM-DD-awesome-monitoring.log' в директорию /var/log 
        (YY — год, MM — месяц, DD — день);
        - каждый сбор метрик складывается в виде json-строки, в виде:
          + timestamp — временная метка, int, unixtimestamp;
          + metric_1 — метрика 1;
          + metric_2 — метрика 2;
        
             ...
           
          + metric_N — метрика N.
        
        - сбор метрик происходит каждую минуту по cron-расписанию.
      
      Для успешного выполнения задания нужно привести:
      
      * работающий код python3-скрипта;
        * конфигурацию cron-расписания;
        * пример верно сформированного 'YY-MM-DD-awesome-monitoring.log', имеющий не меньше пяти записей.
      
      Дополнительная информация:
      
      1. Количество собираемых метрик должно быть не меньше четырёх.
         1. По желанию можно не ограничивать себя только сбором метрик из `/proc`.
---