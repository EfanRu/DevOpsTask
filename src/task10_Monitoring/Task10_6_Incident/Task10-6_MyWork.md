# Домашнее задание к занятию 17 «Инцидент-менеджмент»

### Задание
    Составьте постмортем на основе реального сбоя системы GitHub в 2018 году.
    
    Информацию о сбое можно изучить по ссылкам ниже:
    
* [краткое описание на русском языке](https://habr.com/ru/post/427301/);
* [развёрнутое описание на английском языке](https://github.blog/2018-10-30-oct21-post-incident-analysis/).

### Решение

#### Краткое описание инцидента
    На нескольких сервисах GitHub.com пострадали несколько сетевых разделов и последующим сбоем базы данных, что привело к появлению нарушению согласованности данных в разных кластерах.

#### Что предшествовало инциденту
    Плановые работы по техническому обслуживанию для замены вышедшего из строя оптического оборудования 100G.

#### Причина ицидента
    Плановые работы по техническому обслуживанию для замены вышедшего из строя оптического оборудования 100G привели к потере связи между нашим сетевым хабом на Восточном побережье США и нашим основным центром обработки данных на Восточном побережье США.

#### Обнаружение
    В 21.10.2018 22:54 Внутренние системы мониторинга начали генерировать предупреждения. Инженеры определили, что топологии для кластеров баз данных нарушена и зарегистрировали активный инцидент.
#### Реакция
    Восстановление системы заняло 24 часа и 11 минут.

#### Восстановление
    Прекращение выполнение заданий, которые записывают метаданные, чтобы сохранить пользовательские данные.
    Инициирован процесс резервного копирования для всех затронутых кластеров MySQL.
    Развернуты несколько инстансов БД только на чтение, чтобы снизить нагрузку.
    При возросшей нагрузке с началом рабочего дня время окончания задержки репликации увеличивались вместо того, чтобы уменьшаться.
    Пришлось сбалансировать возросшую нагрузку, связанную с отставанием, потенциально перегружая уведомлениями клиентов.

#### Таймлайн
    21.10.2018 22:54 Внутренние системы мониторинга начали генерировать предупреждения, указывающие на многочисленные сбои.
    21.10.2018 23:02 Инженеры определили, что топологии для кластеров баз данных нарушена. Запрос к API Orchestrator показал топологию репликации базы данных, которая включала только серверы из центра обработки данных на Западном побережье США.
    21.10.2018 23:07 блокировка внутренних инструментов деплоя, чтобы предотвратить внесение каких-либо дополнительных изменений.
    21.10.2018 23:09 Зарегистрировали активный инцидент желтой категории и отправили сообщение координатору.
    21.10.2018 23:11 Координатор изменил статус на красный.
    21.10.2018 23:13 Были вызваны дополнительные инженеры из команды разработчиков баз данных GitHub.
    21.10.2018 23:19 Стало ясно, что нужно прекратить выполнение заданий, которые записывают метаданные, чтобы сохранить пользовательские данные.
    22.10.2018 00:05 Приступили к разработке плана устранения несоответствий данных.
    22.10.2018 00:41 Был инициирован процесс резервного копирования для всех затронутых кластеров MySQL.
    22.10.2018 06:51 Несколько кластеров завершили восстановление из резервных копий и приступили к репликации новых данных. Это приводило к медленной загрузке сайта для страниц, которым приходилось выполнять операцию записи по межстрановой ссылке, но страницы, считываемые из этих кластеров баз данных, возвращали актуальные результаты, если запрос на чтение поступал на недавно восстановленную реплику. Другие более крупные кластеры баз данных все еще восстанавливались.
    22.10.2018 07:46 GitHub опубликовал запись в блоге.
    22.10.2018 11:12 Все праймериз базы данных снова созданы на Восточном побережье США. Это улучшило скорость работы сайта. Но возросла нагрузка на сайт по вливанию новых данных, так как наступило рабочее время.
    22.10.2018 13:15 Приближались к пиковой транспортной нагрузке на GitHub.com. Стало ясно, что задержки репликации увеличивались вместо того, чтобы уменьшаться. Как только развернулись реплики для чтения MySQL, нагрузка снизилась.
    22.10.2018 16:24 Как только реплики были синхронизированы, выполнили переход на исходную топологию, решились проблемы с задержкой/доступностью.
    22.10.2018 16:45 Пришлось сбалансировать возросшую нагрузку, связанную с отставанием, потенциально перегружая уведомлениями клиентов.
    22.10.2018 23:03 Восстановление системы.

#### Последующие действия
    Устранение несоответствий в данных. 
    Во время восстановления захватили двоичные журналы MySQL, содержащие записи, которые сделали на основном сайте, которые не были реплицированы на сайт на Западном побережье из каждого затронутого кластера.

    Коммуникация.

    Технические инициативы.
    Изменение конфигурации Orchestrator, чтобы предотвратить распространение первичных данных базы данных через региональных границ.
    Ускорили переход на новый механизм отчетности о статусе.
    Поддержка обслуживания трафика GitHub.
    Улучшить тестирование.


---